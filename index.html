<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript高功耗演示</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e6e6e6;
            min-height: 100vh;
        }
        
        .container {
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            color: #4cc9f0;
            margin-bottom: 30px;
            font-size: 2.5rem;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        .warning {
            background-color: rgba(255, 100, 100, 0.2);
            border-left: 5px solid #ff6b6b;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 5px;
            font-size: 1.1rem;
        }
        
        .warning h3 {
            color: #ff9e7d;
            margin-top: 0;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
            justify-content: center;
        }
        
        button {
            padding: 12px 25px;
            font-size: 1.1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        #startBtn {
            background: linear-gradient(135deg, #4cc9f0 0%, #4361ee 100%);
            color: white;
        }
        
        #stopBtn {
            background: linear-gradient(135deg, #f72585 0%, #b5179e 100%);
            color: white;
        }
        
        #resetBtn {
            background: linear-gradient(135deg, #ffbe0b 0%, #fb5607 100%);
            color: white;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(0, 0, 0, 0.3);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .slider-container {
            margin: 25px 0;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        #intensityValue {
            color: #4cc9f0;
            font-weight: bold;
        }
        
        input[type="range"] {
            width: 100%;
            height: 15px;
            border-radius: 10px;
            background: #2d3047;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #4cc9f0;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.4);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-box {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #4cc9f0;
            margin: 10px 0;
        }
        
        .stat-label {
            font-size: 1rem;
            color: #aaa;
        }
        
        .visualization {
            height: 200px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin-top: 30px;
            overflow: hidden;
            position: relative;
        }
        
        .workload-bars {
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            height: 100%;
            padding: 0 10px;
        }
        
        .bar {
            width: 30px;
            background: linear-gradient(to top, #4cc9f0, #4361ee);
            border-radius: 5px 5px 0 0;
            transition: height 0.5s ease;
        }
        
        .workload-info {
            position: absolute;
            bottom: 10px;
            right: 10px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }
        
        .info {
            margin-top: 30px;
            font-size: 0.95rem;
            color: #aaa;
            line-height: 1.6;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>JavaScript高功耗演示</h1>
        
        <div class="warning">
            <h3>⚠️ 警告：高功耗实验</h3>
            <p>此页面通过高强度JavaScript计算来增加设备功耗，可能会导致：</p>
            <ul>
                <li>设备发热、风扇高速运转</li>
                <li>电池电量快速消耗（笔记本电脑/移动设备）</li>
                <li>系统响应变慢（低配置设备）</li>
            </ul>
            <p>请合理控制使用时间，避免设备过热。实验完成后请点击"停止计算"按钮。</p>
        </div>
        
        <div class="controls">
            <button id="startBtn">开始计算</button>
            <button id="stopBtn" disabled>停止计算</button>
            <button id="resetBtn">重置统计</button>
        </div>
        
        <div class="slider-container">
            <div class="slider-label">
                <span>计算强度：</span>
                <span id="intensityValue">中等</span>
            </div>
            <input type="range" id="intensitySlider" min="1" max="10" value="5">
        </div>
        
        <div class="stats">
            <div class="stat-box">
                <div class="stat-label">计算时间</div>
                <div id="timeValue" class="stat-value">0.0s</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">计算次数</div>
                <div id="countValue" class="stat-value">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">CPU负载</div>
                <div id="cpuValue" class="stat-value">0%</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">计算强度</div>
                <div id="levelValue" class="stat-value">5/10</div>
            </div>
        </div>
        
        <div class="visualization">
            <div class="workload-bars" id="workloadBars">
                <!-- 通过JS动态生成柱状图 -->
            </div>
            <div class="workload-info" id="workloadInfo">计算负载可视化</div>
        </div>
        
        <div class="info">
            <h3>工作原理说明：</h3>
            <p>此页面通过以下方式消耗系统资源：</p>
            <ol>
                <li><strong>密集浮点运算</strong>：持续进行三角函数、指数函数等复杂计算</li>
                <li><strong>大数据处理</strong>：创建和操作大型数组进行排序和查找</li>
                <li><strong>可视化渲染</strong>：实时更新DOM元素和Canvas绘制</li>
                <li><strong>内存操作</strong>：频繁创建和释放对象，增加内存压力</li>
            </ol>
            <p>所有计算完全在浏览器中运行，不涉及任何网络请求或外部资源。页面关闭后所有计算立即停止。</p>
        </div>
    </div>

    <script>
        // 全局变量
        let isRunning = false;
        let startTime = 0;
        let calculationCount = 0;
        let animationFrameId = null;
        let intensity = 5;
        let workers = [];
        
        // DOM元素引用
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const resetBtn = document.getElementById('resetBtn');
        const intensitySlider = document.getElementById('intensitySlider');
        const intensityValue = document.getElementById('intensityValue');
        const timeValue = document.getElementById('timeValue');
        const countValue = document.getElementById('countValue');
        const cpuValue = document.getElementById('cpuValue');
        const levelValue = document.getElementById('levelValue');
        const workloadBars = document.getElementById('workloadBars');
        const workloadInfo = document.getElementById('workloadInfo');
        
        // 计算强度描述
        const intensityDescriptions = {
            1: "极低", 2: "很低", 3: "低", 4: "较低",
            5: "中等", 6: "中高", 7: "高", 8: "很高",
            9: "极高", 10: "极限"
        };
        
        // 初始化柱状图
        function initBars() {
            workloadBars.innerHTML = '';
            for (let i = 0; i < 15; i++) {
                const bar = document.createElement('div');
                bar.className = 'bar';
                bar.style.height = '10px';
                workloadBars.appendChild(bar);
            }
        }
        
        // 更新柱状图
        function updateBars() {
            const bars = document.querySelectorAll('.bar');
            bars.forEach((bar, index) => {
                // 基于计算强度和随机性设置高度
                const baseHeight = 10 + (intensity * 5);
                const randomFactor = 0.7 + Math.random() * 0.6;
                const sineFactor = Math.sin(Date.now() / 1000 + index) * 0.3 + 0.7;
                const height = baseHeight * randomFactor * sineFactor;
                bar.style.height = `${Math.min(height, 180)}px`;
            });
            
            // 更新工作负载信息
            const loadPercent = Math.min(intensity * 10 + Math.random() * 20, 100);
            workloadInfo.textContent = `工作负载: ${Math.round(loadPercent)}%`;
        }
        
        // 高强度计算函数
        function heavyCalculation() {
            let result = 0;
            const size = 5000 + intensity * 1000;
            
            // 创建大型数组并填充数据
            const array = new Array(size);
            for (let i = 0; i < size; i++) {
                array[i] = Math.random() * 1000;
            }
            
            // 复杂数学运算
            for (let i = 0; i < size; i++) {
                // 密集的浮点运算
                const x = array[i];
                result += Math.sin(x) * Math.cos(x) * Math.tan(x * 0.01);
                result += Math.exp(x * 0.001) * Math.log(x + 1);
                result += Math.sqrt(x) * Math.pow(x, 0.7);
                
                // 额外的三角函数计算
                result += Math.atan2(x, i + 1) * Math.asin((x % 100) / 100);
            }
            
            // 数组排序和查找（增加CPU负载）
            array.sort((a, b) => a - b);
            
            // 更多数学运算
            for (let i = 0; i < size / 10; i++) {
                result += Math.hypot(array[i], array[size - i - 1]);
                result += Math.fround(result * 0.01);
            }
            
            // 创建和操作对象（增加内存压力）
            const obj = {};
            for (let i = 0; i < size / 100; i++) {
                obj[`key${i}`] = {
                    value: Math.random(),
                    nested: { x: i, y: result, z: array[i] }
                };
            }
            
            calculationCount++;
            return result;
        }
        
        // 主要计算循环
        function calculationLoop() {
            if (!isRunning) return;
            
            // 执行高强度计算
            heavyCalculation();
            
            // 更新统计信息
            updateStats();
            
            // 更新可视化
            updateBars();
            
            // 使用requestAnimationFrame继续循环
            animationFrameId = requestAnimationFrame(calculationLoop);
        }
        
        // 更新统计信息
        function updateStats() {
            // 更新计算时间
            const elapsed = (Date.now() - startTime) / 1000;
            timeValue.textContent = elapsed.toFixed(1) + 's';
            
            // 更新计算次数
            countValue.textContent = calculationCount.toLocaleString();
            
            // 估算CPU负载（基于计算强度）
            const cpuLoad = Math.min(30 + intensity * 7 + Math.random() * 15, 100);
            cpuValue.textContent = Math.round(cpuLoad) + '%';
            
            // 更新计算强度
            levelValue.textContent = `${intensity}/10`;
        }
        
        // 创建Web Workers进行多线程计算（可选）
        function createWorkers() {
            // 清理现有workers
            cleanupWorkers();
            
            // 根据强度创建不同数量的workers
            const workerCount = Math.min(intensity, navigator.hardwareConcurrency || 4);
            
            for (let i = 0; i < workerCount; i++) {
                // 创建worker进行额外计算
                const workerCode = `
                    self.onmessage = function(e) {
                        const intensity = e.data;
                        let result = 0;
                        const size = 2000 + intensity * 500;
                        
                        // Worker内部的重计算
                        for (let j = 0; j < size; j++) {
                            const x = Math.random() * 1000;
                            result += Math.sin(x) * Math.cos(x);
                            result += Math.exp(x * 0.001);
                            result += Math.sqrt(x) * Math.pow(x, 0.5);
                            
                            // 创建一些数组操作
                            const arr = new Array(100);
                            for (let k = 0; k < 100; k++) {
                                arr[k] = Math.random();
                            }
                            arr.sort();
                        }
                        
                        self.postMessage({result: result});
                    };
                `;
                
                const blob = new Blob([workerCode], { type: 'application/javascript' });
                const worker = new Worker(URL.createObjectURL(blob));
                
                // 定期向worker发送计算任务
                const intervalId = setInterval(() => {
                    if (isRunning) {
                        worker.postMessage(intensity);
                    }
                }, 100);
                
                workers.push({
                    worker,
                    intervalId
                });
                
                // 处理worker返回的结果（虽然我们不需要实际结果）
                worker.onmessage = function(e) {
                    // 结果可以忽略，只是为了让worker持续工作
                };
            }
        }
        
        // 清理Web Workers
        function cleanupWorkers() {
            workers.forEach(w => {
                clearInterval(w.intervalId);
                w.worker.terminate();
            });
            workers = [];
        }
        
        // 事件监听器
        startBtn.addEventListener('click', () => {
            if (isRunning) return;
            
            isRunning = true;
            startTime = Date.now();
            calculationCount = 0;
            
            startBtn.disabled = true;
            stopBtn.disabled = false;
            
            // 根据强度决定是否使用Web Workers
            if (intensity >= 7) {
                createWorkers();
            }
            
            // 开始计算循环
            calculationLoop();
        });
        
        stopBtn.addEventListener('click', () => {
            isRunning = false;
            
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
            }
            
            cleanupWorkers();
            
            startBtn.disabled = false;
            stopBtn.disabled = true;
        });
        
        resetBtn.addEventListener('click', () => {
            isRunning = false;
            
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
            }
            
            cleanupWorkers();
            
            calculationCount = 0;
            startTime = 0;
            
            timeValue.textContent = '0.0s';
            countValue.textContent = '0';
            cpuValue.textContent = '0%';
            
            startBtn.disabled = false;
            stopBtn.disabled = true;
            
            // 重置柱状图
            initBars();
            workloadInfo.textContent = '计算负载可视化';
        });
        
        intensitySlider.addEventListener('input', () => {
            intensity = parseInt(intensitySlider.value);
            intensityValue.textContent = intensityDescriptions[intensity] || '中等';
            levelValue.textContent = `${intensity}/10`;
        });
        
        // 页面初始化
        function init() {
            initBars();
            intensityValue.textContent = intensityDescriptions[intensity];
        }
        
        // 页面卸载时停止所有计算
        window.addEventListener('beforeunload', () => {
            isRunning = false;
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
            }
            cleanupWorkers();
        });
        
        // 初始化页面
        init();
    </script>
</body>
</html>
